# 基本语法

## 数据类型

JAVA--强类型语言，必须为每一个变量声明一种类型。且除非显性的强制类型转换，否则变量类型不可变。

### 基本类型

#### 整型（4）

用于表示没有小数部分的数值，允许是负数。`short` 和 `byte` 常用于底层文件的处理或者需要控制占用存储空间容量的大数组。

`Long` 有一个后缀 `L/l` ；十六进制有个前缀 `0x` 或 `0X` ；八进制有个前缀 `0` 。从`java7` 开始，数字字面量可以加下划线方便阅读，编译器会去掉；加上前缀 `0b` 或 `0B` 可以书写二进制数。

##### int

存储占4字节，取值范围为 -2 147 483 648~2 147 483 647（正好超过20亿）

##### short

存储占2字节，取值范围为 -32 768~32 767

##### long

存储占8字节，取值范围为 -9 223 372 036 854 775 808~9 223 372 036 854 775 807。

##### byte

存储占1字节，取值范围为 -128~127

#### 浮点型（2）

用于表示有小数部分的数值。`double` 数值精度为 `float` 两倍，`float` 只有很少的情况下适用（需要单精度数据的库，或需要存储大量数据），基本上都使用 `double` 。`float` 有个后缀 `f/F` ，`double` 类型有个后缀 `d/D` ，默认是 `double` 类型。

##### float

存储占4字节，取值范围大约为 -3.402 823 47E+38F ~ 3.402 823 47E+38F，有效数位为6~7位。（3.40282347*10的38次方，F代表float）

##### double

存储占8字节，取值范围大约为-1.797 693 134 862 315 70E+308 ~ 1.797 693 134 862 315 70E+308，有效数位为15位。

**表示溢出或出错的三个特殊值：** 

- 正无穷大（POSITIVE_INFINITY）：正整数除0
- 负无穷大（NEGATIVE_INFINITY）
- 不是一个数字（NaN）：0/0或者负数的平方根；不能适用 `x == Double.NaN` 来检测一个特定值是否是非数值，因为所有非数值的值都认为是不同的，所以该结果永远是 `false` 。可以使用 `Double.isNaN(x)` 来检测。

##### [精度问题](https://blog.51cto.com/u_16213567/7186889)

浮点数值不适用于无法接受舍入误差的金融计算中，因为浮点数值采用二进制系统表示，二进制数无法精确表示1/10，此时应该用[BigDecimal](#BigDecimal)类

```
2.0 - 1.1 = 0.8999999999999999
```



#### 字符类型（1）

##### char

在JAVA中，char类型描述了[UTF-16](./附录D-Unicode编码.md)编码中的一个代码单元。

字面量值要用 `''` 括起来。可以用来表示 [`Unicode`](./附录D-Unicode编码.md) 编码（一个或两个char值）。

可以用来表示十六进制值，范围从 `\u0000-\Uffff` 

##### **转义序列** 

所有转义序列都可以出现在加引号的字符字面量或字符串中， `\u` 还可以出现外面（其他不可以，因为Unicode转义序列会在编译期处理，所以要小心使用 `\u`）

| 转义序列 | 名称   | Unicode值 |
| -------- | ------ | --------- |
| \u       | 转义   |           |
| \b       | 退格   | \u0008    |
| \t       | 制表   | \u0009    |
| \n       | 换行   | \u000a    |
| \t       | 回车   | \u000d    |
| \\"      | 双引号 | \u0022    |
| \\'      | 单引号 | \u0027    |
| \\\      | 反斜杠 | \u005c    |
|          |        |           |

不建议在程序中使用char类型（除非确实要处理UTF-16代码单元），最好使用字符串。

#### 布尔类型（1）

##### boolean

`true` & `false` ；在JAVA中，整型值与布尔值不能相互转换（C++可以）

#### Void型

void类型，无法直接对其进行操作

### 引用类型

类似于指针，指向一个对象，默认值都是null。

#### 引用变量 VS 引用对象

引用变量并没有实际包含一个引用类型对象，引用变量中存储的是实际引用类型对象的**地址（引用）**。new操作符返回的也是一个**地址（引用）**。

### 包装器类

每个基本类型都有一个与之对应的包装器类（wrapper）。这些包装器都是**不可变类**，即一旦构造了包装器，就不允许更改包装在其中的值。同时它们也是final类，无法被继承。

- Integer
- Long
- Float
- Double
- Short
- Byte

这6个派生于`Number` 抽象类

- Character
- Void
- Boolean

##### 自动装箱/拆箱

这种操作是编译器认可的，而不是虚拟机。编译器在生成类的字节码时，插入必要的方法调用。虚拟机只是执行这些字节码。

```java
// 源码
package base;

public class WrapperClassTest {
    public static void main(String[] args) {
        Integer a = 1;
        System.out.println(a);

        Integer b = new Integer(2);
        int c = b;
        System.out.println(c);
    }
}
```

```java
// 编译后的字节码文件
package base;

public class WrapperClassTest {
  public static void main(String[] paramArrayOfString) {
    Integer integer1 = Integer.valueOf(1);
    System.out.println(integer1);
    Integer integer2 = new Integer(2);
    int i = integer2.intValue();
    System.out.println(i);
  }
}
```



###### 自动装箱

将基本类型赋值给对应的包装类型，编译器会自动插入一个对包装类型构造方法的调用

###### 自动拆箱

将一个包装器类型对象赋值给一个对应的基本类型变量，编译器会自动插入一个对改包装器类型xxxValue方法的调用

**自动装箱的规范要求，以下情况数据被包装到固定的对象中：** 

- boolean
- byte
- char <= 127
- short (-128-127)
- int（-128-127）

##### 比较

包装器类是对象，对象的比较使用equals方法。由于[某些数据](#自动装箱/拆箱)会被包装到同一个对象中，所以有时 == 也可能成立，要注意。

### 枚举类型

枚举类型的变量只能取类声明中定义好的值或者null值。

```java
public enum Size {
    
    SMALL,MEDIUM,LARGE,EXTRA_LARGE;
    
}
```

枚举类都是`Enum`类的子类型。可以拥有实例域，方法；**其中构造方法必须为private 。（默认是private）** 

```java
public enum Size {

    SMALL("S"),MEDIUM("M"),LARGE("L"),EXTRA_LARGE("XL");

    private String abbreviation;

    Size(String abbreviation) {
        this.abbreviation = abbreviation;
    }

    public String getAbbreviation() {
        return abbreviation;
    }

}
```

而`Enum`类是一个泛型类，所以，所有地枚举类型都扩展于`Enum<>`可以表示为 `Weekday 扩展于 Enum<Weekday>` .

枚举类不允许继承，不能被实例化（new）

### 字符串

从概念上讲，JAVA字符串就是[Unicode](./附录D-Unicode编码.md)字符序列。JAVA没有内置的字符串类型，而是在标准JAVA类库中提供了一个[**预定义类String**](./附录C-字符串.md)，每个用 `""` 括起来的字符串都是该类的一个实例。 

### 大数值

当基本类型中整型和浮点型的精度不能满足要求时可以使用，位于`java.math`包下。可以处理包含任意长度数字序列的数值。使用 `valueOf()` 方法可以将普通数值转换为大数值。

#### `BigInteger`

实现了任意精度的整数运算。

#### `BigDecimal`

实现了任意精度的浮点数运算。

### 类型转换

**合法的转换（可能会丢失精度）** 

<img :src="$withBase('/img/02-cast-class.png')" class="align-center" />

**二元操作数据类型自动转换规则** 

1. 两个操作数中有double类型，则另一个也被转为double类型
2. 否则，两个操作数中有float类型，则另一个也被转为float类型
3. 否则，两个操作数中有long类型，则另一个也被转为long类型
4. 否则，都被转为int类型

**强制类型转换** 

```java
double x = 9.997;
int nx = (int) x;  // 9
```

通过截断小数部分将浮点型转换为整型，如果需要对浮点数进行舍入运算，建议使用 [`Math.round()`](./附录B-常用工具包.md) 方法。

尽量不要使用强制类型转换，如果原类型超出目标类型表示范围，会采取截断方式，这样得到的结果可能不符合预期。

布尔类型与任何数值类型之间不能进行强制类型转换（除了公共父类[`Object`](./Object类.md)），在某些特定情况下，可以使用[三元表达式](#三元操作符)。

##### 对象之间地强制类型转换

- 只能在继承层次内进行类型转换
- 在将**超类转换成子类**之前，应该先使用`instanceof`进行检查

超类引用想要强制转为子类，那么超类引用的对象的实际类型必须是子类或子类的子类。

```
null instanceof 任何类型 这个都将返回false，因为null代表没有引用任何对象。
```

###### 意义

强制转换的意义在于，在暂时忽略对象的实际类型之后，使用对象的全部功能。例如，Manager与Employee都是Employee，在一个拥有Manager的Employee数组中，需要使用Manager的独有的功能，需要将这个隐藏于Employee的Manager强制转换为Manager。

## 运算符

#### 算数运算符

##### 基本算数运算符

在进行浮点运算时，由于CPU处理器的寄存器位数和实现方式不同，可能会造成在不同的机器上计算结果不同，这是由于有的位数高于64位的机器会在计算的中间结果上扩展精度，可使用 [`strictfp`](./附录E-JAVA常用关键字.md) 关键字标识（标识在方法返回值类型前，或类class关键字前）。

- `+`

- `-`

- `*`

- `/`

当操作数都为整数时，表示整数除法；否则表示浮点除法

```
10 / 3 = 3
10.0 / 3 = 3.3333333333333335
```

整数被0除将会产生一个异常

```java
java.lang.ArithmeticException: / by zero
```

浮点数被0除会得到无穷大或者`NaN` 

- `%`

##### 运算符与赋值符结合

- `+=`

- `*=`

- `/=`

- `%=`

- `-=`

```java
int x = 100;
x += 10; // 110
x *= 2; // 220
x /= 11; // 20
x -= 10; // 10
x %= 3; // 1
```

结合赋值与运算符写法，当等号两侧值类型不同时，会发生强制类型转换，以左侧为主。

##### 自增`/`自减运算符

- `++`

- `--`

自增/自减运算符分为前缀和后缀形式，前缀表示先自增/自减，然后进行表达式计算，后缀表示先进行表达式计算，在自增/自减。

##### 关系运算符

- `==`

- `!=`

- `<`

- `>` 

- `<=`

- `>=` 

##### 逻辑运算符

- `&&`

- `||`

`&&`和`||` 是短路运算符

- `!`

##### 三元操作符

- `？ ：`

```java
condition ? expression1 : expression2;
```

##### 位运算符*

在处理**整型** 类型时，可以直接对组成整型数值的各个位完成操作。

- `&`

- `|`

`&` 和 `|` 应用于布尔值上，不再是短路运算，而是两个操作数都需要计算其结果。

- `^`
  相同为0，相异为1

- `~`

- `>>` 
  按位右移运算符。左操作数按位右移右操作数指定的位数。

- `<<`
   按位左移运算符。左操作数按位左移右操作数指定的位数。

- `>>>` 

无符号右移，高位补0。左操作数的值按右操作数指定的位数右移，移动得到的空位以零填充。

##### `instanceof`运算符

用于操作对象实例，检查该对象是否是一个特定类型（类类型或接口类型）。

##### 运算符优先级

| 运算符                                               | 结合性   |
| :--------------------------------------------------- | -------- |
| [].()（方法调用）                                    | 从左向右 |
| !/~/++/--/+（一元运算）/-（一元运算）/()（强转）/new | 从右向左 |
| */**`/`**(整除)/%                                    | 从左向右 |
| +/-                                                  | 从左向右 |
| <</>>/>>>                                            | 从左向右 |
| </<=/>/>=/`instanceof`                               | 从左向右 |
| ==/!=                                                | 从左向右 |
| &                                                    | 从左向右 |
| ^                                                    | 从左向右 |
| \|                                                   | 从左向右 |
| &&                                                   | 从左向右 |
| \|\|                                                 | 从左向右 |
| ?:                                                   | 从右向左 |
| =/+=/-=/*=/**`/=`** /%=/&=/\|=/^=/<<=/>>=/>>>=       | 从右向左 |

## 流程控制语句

### 条件语句

#### if...else if...else...

#### switch case

**case标签类型** ：

- char、byte、short、int的常量表达式
- 枚举常量
- 从`javaSE 7`开始，可以是字符串字面量

注意**break**的使用

### 循环语句

#### while

#### do...while...

至少执行一次

#### for

#### for each

`javaSE 5.0`新增，循环的源数据表达式必须是一个[数组](./03-JAVA数据结构)或是一个实现了`Iterable` 接口的类对象（例如`ArrayList`）。

#### [Iterator（迭代器）](./05-JAVA集合.md) 

### 中断语句

goto作为保留字，但是并未使用。

#### break

跳出单层循环

#### break label

跳出label处的循环，并继续向下执行。

标签可以用到任何语句中

```java
label:
{
	...
	if(condition) break label;
	...
}
```

上述语句会跳出块，然后继续向下执行。

#### continue

跳到循环首部，继续下次循环

#### continue label

## 注释

#### 注释本行

`//` 

#### 注释一段代码

`/*   */` 

不支持嵌套

#### 注释文档

`/**    */` 

#### [文档注释](./附录F-JAVA文档注释.md) 

## 变量与常量

### 变量

变量由字母开头，且由字母和数字构成。其中字母包括`A-Z、a-z、_、$`或在某种语言中表示字母的任何`Unicode`字符。数字包括`0-9`和在某种语言中表示数字的任何`Unicode`字符

在JAVA中不区分变量的声明与定义，如果使用未初始化的变量会抛出异常。

在C++中区分变量的声明与定义

```c++
int i = 10; // 定义
extern int i; // 声明
```

#### 局部变量（方法变量）

局部变量在声明后不会自动初始化，需要在声明后手动初始化才能使用。

#### 全局变量（类变量/域）

类变量在声明后会自动初始化。数值默认为0，布尔值默认为false，对象引用默认为null。

##### 普通成员变量

##### 静态成员变量

### 常量

常量使用 [`final` 关键字](./附录E-JAVA常用关键字.md)指示，表示该变量只能被赋值一次，一旦赋值，不能修改。通常使用全大写表示。

[类常量](#静态常量（类常量）)，[`static final`](./附录E-JAVA常用关键字.md) 指示，可以在一个类中的各个方法中使用；若访问权限为 `public` ，则其他类也可以使用。

`const` 是JAVA保留的关键字，但是并未使用，在C++中指示常量。

#### [常量表达式](https://docs.oracle.com/javase/specs/jls/se17/html/jls-15.html#jls-15.29) 

是表示原始类型或String类型的表达式，可以通过计算得出。

常见的常量表达式：

- 基本类型以及String类型的字面量（使用new或者变量引用的不算）
- 基本类型以及String类型的强制类型转换
- 使用+等一元运算符进行加法/拼接运算得出的值

#### 静态常量（类常量）

常量使用[final](./附录E-JAVA常用关键字.md)修饰符，静态常量再常量的基础上在final之前使用[static](./附录E-JAVA常用关键字.md)修饰符。

#### 编译器常量

1. 被声明为final
2. 基本类型或者String类型
3. 声明时便已经初始化
4. 初始化可以使用常量表达式初始化

## 作用域

### 块作用域

块，也就是复合语句，是指由一对大括号括起来的若干条简单的JAVA语句。它确定了变量的作用域。可以嵌套，但是在嵌套的块中变量不允许重名定义（但是C++可以，内层覆盖外层）。

### [包](./包与导入.md)作用域

- 包声明语句应该放在文件首行，且每个文件都只能最多有一个包声明语句。
- 如果文件没有显式声明包，默认在一个无名的包中（unnamed package）

### 访问权限修饰符

- **private**：仅对本类可见，不能修饰外部类
- **public**：对所有类可见
- **protected**：对本包和所有子类可见，该关键字限制了子类对象的方法只能访问子类对象的protected域，不能访问父类的（尽管子类的该域是从父类继承过来的），不能修饰外部类
- **默认**，不需要修饰符：对本包可见

### 类的可见性

只有内部类可以声明为private、protected，常规类只可以具有包可见性（默认，无修饰符），或公有可见性（public）

## 输入/输出

### 控制台输入/输出

#### 输入

##### Scanner

```java
Scanner scan = new Scanner(System.in);
```



##### Console

```java
public  class App {

    public static void main(String[] args) {

        Console cons = System.console();
        String username = cons.readLine("User name:");
        char[] passwd = cons.readPassword("Password:");
        System.out.println(username + "'s password is " + Arrays.toString(passwd));
    }

}
/*
User name:nihao
Password:
nihao's password is [4, 5, 8, 6, 9, 8, 7, 5, 5]
*/
```

#### 输出

##### System.out

###### print()

以，括号中内容所对应的数据类型，所允许的，最大非0数字位数，来打印输出。

###### println()

末尾换行

###### printf()

**转换符** 

| 转换符 | 类型                  | 举例                              |
| ------ | --------------------- | --------------------------------- |
| d      | 十进制整数            | 159                               |
| x      | 十六进制整数          | 9f                                |
| o      | 八进制整数            | 237                               |
| f      | 定点浮点数            | 15.9                              |
| e      | 指数浮点数            | 1.59e+01                          |
| g      | 通用浮点数            | --                                |
| a      | 十六进制浮点数        | 0x1.fccdp3                        |
| s      | 字符串                | Hello                             |
| c      | 字符                  | H                                 |
| b      | 布尔                  | True                              |
| h      | 散列码                | 42628b2                           |
| tx或Tx | 日期时间（T强制大写） | 已经过时，应当改为使用java.time类 |
| %      | 百分号                | %                                 |
| n      | 与平台有关的行分隔符  | --                                |
|        |                       |                                   |

**用于`printf`的标志** 

| 标志            | 目的                                                         | 举类          |
| --------------- | ------------------------------------------------------------ | ------------- |
| +               | 打印正数和负数的符号                                         | +3333.33      |
| 空格            | 在正数之前添加空格                                           | \|  3333.33\| |
| 0               | 数字前面补0                                                  | 003333.33     |
| -               | 左对齐                                                       | \|3333.33  \| |
| (               | 将负数括在括号里                                             | (3333.33)     |
| ,               | 添加分组分隔符                                               | 3,333.33      |
| #(对于f格式)    | 包含小数点                                                   | 3,333.        |
| #(对于x或0格式) | 添加前缀0x或0                                                | 0xcafe        |
| $               | 给定被格式化的参数索引。<br />例如，%1$d，%1$x将以十进制和十六进制格式打印第1个参数 | 159<br />9F   |
| <               | 格式化前面说明的数值。例如，%d%<x以十进制和十六进制打印同一个数值 | 159<br />9F   |
|                 |                                                              |               |

<img :src="$withBase('/img/02-string-format.png')" class="align-center"/>

### 文件的输入/输出

#### 输出（读取）

##### Scanner

```java
Scanner in = new Scanner(Paths.get("myfile.txt"), "UTF-8");
```

读取文件时，建议指定字符编码，这就要求我们要事先知道文件的字符编码。如果省略字符编码，JAVA会默认使用当前机器的”默认编码“，这在不同的机器上，程序的表现可能会有所不同。

```java
public static void main(String[] args) throws IOException {
   Scanner scanner = new Scanner(Paths.get("./src/main/java/myfile.txt"), "UTF-8");
   System.out.println(scanner.nextLine());
   // 获取当前启动路径，结合当前路径去填写上面文件的相对路径
   System.out.println(System.getProperty("user.dir")); 
   // C:\Users\xpf14\AppData\LocalRepository\removing\dfei
}
```

#### 输入（写入）

##### PrintWriter

```java
PrintWriter out = new PrintWriter("myfile.txt", "UTF-8");
```

```java
public  class App {

    public static void main(String[] args) throws IOException {
        PrintWriter printWriter = new PrintWriter("./src/main/java/myfile.txt", "UTF-8");
        printWriter.println("hihihihihi");
        printWriter.flush();
        printWriter.close();
    }

}
```

