# 内存基本知识

## 内存

内存用于存放数据，程序执行前必须先被放到内存中才能被CPU处理。内存是为了缓和外存与CPU处理速度的差异而存在的

### 常用单位

- 2<sup>10</sup> = 1K（千）
- 2<sup>20</sup> = 1M （兆，百万）
- 2<sup>30</sup> = 1G （十亿，千兆）

## 进程运行基本原理

### 指令

指令由操作码和若干参数（包括地址码等）组成，下面所说的逻辑地址与物理地址既指的是指令要操作的地址，又指的是指令的存储地址

### 逻辑地址与物理地址

程序经过编译、链接后生成的指令中指明的地址是逻辑地址（相对地址，相对于起始地址而言）

在内存中存放的地址是物理地址（实际存储地址）

### 从写程序到程序运行

<img :src="$withBase='/img/os-form-write-code-to-run-code.png'" class="align-center" />

### 编译

由编译程序将用户源代码编译成若干个目标模块（编译就是把高级语言翻译为机器语言）

### 链接

由链接程序将编译后形成的一组目标模块，以及所需库函数链接在一起，形成一个完成的装入模块

#### 静态链接

在程序运行之前，先将各目标模块及它们所需的库函数连接成一个完整的可执行文件（装入模块），之后不再拆开。

<img :src="$withBase='/img/os-link.png'" class="align-center" />

#### 装入时动态链接

将各目标模块装入内存时，边装入边链接的链接方式。

<img :src="$withBase='/img/os-dynamic-link.png'" class="align-center" />

#### 运行时动态链接

在程序执行过程中需要该目标模块时，才对它进行链接。优点是便于修改和更新，便于实现对目标模块的共享。

<img :src="$withBase='/img/os-runtime-dynamic-link.png'" class="align-center" />

### 装入（装载）

由装入程序将装入模块装入内存运行，包括将指令中逻辑地址转物理地址

#### 绝对装入

在编译时，将逻辑地址计算得到绝对地址（物理地址）。此时形成的装入模块中的地址就是绝对地址，按照这个地址将程序和数据装入内存

只适用于单道程序环境，因为单道程序是连续的一个接一个的执行的。且此时还没有产生操作系统，所以说此时的地址转换是由编译器完成的。

#### 可重定向装入（静态重定向）

编译、链接后的装入模块的地址还是从0开始的相对地址（逻辑地址）。根据内存的使用情况，装入时对地址进行“重定位”，将逻辑地址转为物理地址（装入时一次全部完成），如果装入时没有分配作业要求的全部内存空间，则不能装入。且装入后，在运行期间作业不能在移动，也不能再申请内存空间。

用于早期的多道批处理系统中。

#### 动态运行时装入（动态重定向）

编译、链接后的装入模块的地址还是从0开始的相对地址（逻辑地址）。装入程序把装入模块装入内存后，并不会把逻辑地址转换为内存地址，而是把地址转换这步推迟到程序真正要执行时才进行。因此装入内存后所有的地址依然是逻辑地址。这种方式需要一个重定位寄存器，寄存器存放装入模块存放的起始地址。

特点：

1. 允许程序在内存中发生移动
2. 可将程序分配到不连续的存储区中
3. 在程序运行前只需装入它的部分代码即可投入运行，然后在程序运行期间，根据需要动态申请分配内存
4. 便于程序段的共享，可以向用户提供一个比存储空间大得多的地址空间

用于现代操作系统



