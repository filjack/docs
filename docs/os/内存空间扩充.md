# 内存空间扩充

## 覆盖技术

用来解决“程序大小唱过物理内存总和”的问题。覆盖技术只用于早期的操作系统，现在已成为历史。

### 基本概念

#### 思想

思想是将程序分为多个段（多个模块）。常用的段常驻内存，不常用的段则是在需要时调入内存。

#### 内存分区

内存中分为一个“固定区”和若干个“覆盖区”。

多个覆盖区是指，按照自身逻辑结构，让那些不可能同时被访问的程序段共享同一个覆盖区。但是由于有多个覆盖区，所以必须由程序员声明覆盖结构，操作系统完成自动覆盖。缺点是对用户不透明，增加了用户编程负担。

需要常驻的段放在“固定区”，调入后就不再调出（除非运行结束）
不常用的段放在外存，只在需要时调入，放在“覆盖区”，不需要时调出内存。

<img :src="$withBase='/img/os-memory-override.png'" class="align-center" />

## 交换技术

### 基本概念

#### 思想

设计思想是，当内存空间紧张时，系统将内存中某些进程暂时换出外存，把外存中某些已具备运行条件的进程换入内存（进程在内存与磁盘间动态调度）

中级调度就是为了实现交换技术而使用的一种调度策略，其目的是决定将哪个处于挂起状态的进程重新调度内存（进程的PCB会常驻内存，不会被换出外存，这是因为必须有一个进程的标识来告知OS进程被放置到外存哪里了）

### 交换策略

- 保存到外存的什么位置
  放在磁盘空间中的对换区[^1]
- 什么时候交换
  发生在许多进程运行且内存吃紧时，而系统负荷降低就暂停。例如：在发现许多进程运行时经常发生缺页，就说明内存紧张，此时可以换出一些进程；如果缺页率明显下降，就可以暂停换出。
- 哪些进程应该被交换
  - 可以优先换出阻塞进程
  - 可以优先换出优先级较低的进程，但是为了防止优先级低的进程在被调入后很快又被换出，某些系统会考虑进程在内存中的驻留时间



[^1]: 具有对换功能的操作系统中，通常把磁盘文件分为**文件区**和**对换区**两部分。文件区主要用于**存放文件**，主要**追求存储空间的利用率**，因此文件区空间的管理采用**离散分配方式**；对换区空间只占磁盘空间的小部分，由于对换区的速度直接影响到系统的整体速度，因此对换区空间的管理主要**追求换入换出速度**，因此通常对换区采用**连续分配方式**。**对换区的I/O速度比文件区的更快**。