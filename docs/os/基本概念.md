# 基本概念

## 基本释义

操作系统是指控制和管理整个计算机系统的硬件和软件资源，并合理的组织调度计算机的工作和资源的分配；以提供给用户和其他软件方便的接口和环境。它是计算机系统中最基本的系统软件。

- 管理计算机软/硬件资源
- 向上层提供服务
- 最接近硬件的一层软件

## 基本功能

### 资源管理

- 处理机管理（CPU管理）
- 存储器管理（内存管理）
- 文件管理
- 设备管理（外部设备，如显示器等）

### 为上层提供服务

体现了封装的思想：操作系统将复杂的硬件功能封装成简单易用的功能提供给上层使用。

- GUI（图形化用户接口）
- 命令行解释器
  - 联机命令接口（交互式）：命令行窗口，与操作系统交互使用，一次处理一条指令
  - 脱机命令接口（批处理）：将一批命令写入特殊的文件中（例如`.bat`文件）由操作系统进行批处理
  
- 程序接口
  在程序中进行系统调用来使用程序接口，用户无法直接使用程序接口，只能通过程序代码来间接使用

### 最接近硬件的软件

操作系统实现对硬件机器的拓展：指的是将CPU、内存、磁盘、显示器、键盘等硬件合理的组织起来，让各种硬件能够相互协调配合，进而实现更多复杂的功能。

## 基本特征

### 并发

是指两个或多个事件在同一时间间隔内发生，这些事件宏观上是同时发生的，在微观上是交替发生的。

#### 并行与并发

并行是指两个或多个事件在同一时刻是同时发生的

#### 操作系统的并发性

指计算机系统中“同时”运行着多个程序，这些程序宏观上是同时运行的，微观上是交替运行的。

- 单核CPU，在同一时刻，只能同时运行一个程序
- 多个CPU，在同一时刻，能同时运行多个程序

### 共享

是指资源共享。是指系统中的资源可供内存中多个并发执行的进程共同使用。

- 互斥共享方式：一个时间段内只允许一个进程访问，例如QQ、微信同时访问摄像头
- 同时共享方式：一个时间段内允许多个进程“同时”访问。“同时”，往往指代宏观上的同时，即在微观上是交替访问；当然也有可能是真正意义上的同时。例如，QQ、微信同时发送文件

#### 并发与共享

相互依存。如果不存在并发，那么就不存在同一时间段多个进程同时访问一个资源，就不存在共享。如果不存在共享，就不允许同一时间段多个进程交替访问同一个资源，就不存在并发。

### 虚拟

是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体是实际存在的，逻辑上的对应物是用户感受到的。

#### 虚拟技术

- 空分复用技术（如，虚拟存储器技术）
- 时分复用技术（如，虚拟处理器技术）

### 异步

是指，在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停的，以不可预知的速度向前推进。（多个程序的交替执行，在遇到获取共享资源权限的步骤上发生冲突并造成其中某些程序的阻塞等待获取资源）

## 历史发展

### 手工操作阶段

使用纸带机。缺点是用户使用时独立占用整个机器，且用户手工操作阶段速度与机器处理阶段速度相差巨大，造成机器资源浪费。

### 批处理阶段

#### 单道批处理系统

引入脱机输入/输出技术，由监督程序来进行输入/输出的控制。

优点是能够缓解人机处理速度的差异。缺点是资源的利用率还是很低。

#### 多道批处理系统

操作系统开始出现。优点是多道程序并发执行，资源共享使用，利用率高。缺点是缺少人机交互功能

### 分时操作系统

计算机以时间片为单位，轮流为多个用户/作业提供服务，多个用户/作业通过终端与计算机进行交互。

优点是提供了人机交互功能。缺点是不能优先处理紧急任务。

### 实时操作系统

在该系统的控制下，计算机系统接收到外部信号后及时进行处理，并且要在严格的时限内处理完事件。特点是及时性和可靠性。

- 硬实时系统：必须在绝对严格的时限内完成处理，例如自动驾驶系统
- 软实时系统：能够接受偶尔的违反时限的处理，例如12306订票系统

优点是能够优先处理紧急任务。

### 网络操作系统

进行网络中资源的共享，计算机之间的通信

### 分布式操作系统

工作分布在所有的主机上并行、协调执行

### 个人计算机操作系统

例如windows操作系统

## 运行机制

### 运行的两类程序

#### 应用程序

运行在操作系统之上的程序

#### 内核程序

多个内核程序构成了操作系统的内核，内核是操作系统最核心的部分，也是操作系统中最接近硬件的部分。

### CPU执行的两类指令

CPU能够识别出一条指令是特权指令还是非特权指令，但是具体是否执行还要检验自身是否处于内核态

#### 特权指令

只能由操作系统来使用，也就是只有内核程序可以使用，特权指令对整个系统的影响性较大，不单单是影响某个应用程序

#### 非特权指令

### CPU两种处理器状态

CPU中有一个程序状态寄存器（PSW），该寄存器使用内部的一个二进制为来记录当前CPU的处理器状态。一般1是内核态，0是用户态。

#### 内核态

CPU处于内核态时，说明此时正在执行的是内核程序，此时可以执行特权指令。

#### 用户态

CPU处于用户态时，说明此时正在执行的时应用程序，此时特权指令不能执行。

#### 状态间的切换

- 内核态`->`用户态，内核程序执行一条修改PSW的特权指令，修改标志位为用户态，该动作是操作系统主动让出CPU使用权。
- 用户态`->`内核态，由中断引起，中断信号使得硬件自动完成处理器状态的改变，操作系统重新获得CPU的使用权。

## 中断

### 作用

是让操作系统内核重新获取CPU使用权的唯一途径。

### 分类

#### 内中断（异常）

与当前执行的指令有关，中断信号来源与CPU内部

- 故障
  由错误条件引起的，可能被内核程序修复。内核程序修复后将CPU使用权返还给应用程序，使得应用程序继续执行，例如缺页错误
- 终止
  由致命错误引起，内核程序无法修复。一般不会再将CPU使用权返还给应用程序，而是直接终止应用程序。例如执行非法指令或指令参数错误
- 陷入
  应用程序主动执行陷入指令（非特权指令），将CPU使用权交给操作系统内核，期望得到某些帮助。

#### 外中断

与当前执行的指令无关，中断信号来源与CPU外部

- 时钟中断
- I/O中断

### 基本实现原理

#### 检查中断信号

- 内中断：CPU在执行指令时会检查是否有异常发生
- 外中断：CPU每个指令执行周期末尾，会例行检查是否有外中断信号需要处理

#### 获取中断程序进行处理

不通的中断信号，需要用不通的中断程序进行处理。通常CPU会根据中断信号查询中断向量表，以此来找出相应的中断处理程序在内存中的存放位置。

<img :src="$withBase='/img/operating-system-interrupt-vector-table.png'" class="align-center"/>