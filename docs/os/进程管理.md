# 进程管理

## 进程

### 基本概念

#### 程序

静态的，存放在磁盘钟的可执行文件，是一些列指令的集合。

#### 进程

动态的，是程序的一次执行过程。同一个程序多次执行对应多个进程。

进程是进程实体的执行过程，是系统进行资源分配和调度（是指操作系统指定该进程上CPU运行）的独立单位。

#### 进程实体

静态的，反映了进程在某一时刻的状态。

### 组成

*准确来讲，是进程实体的组成。*

#### PCB

PCB（process control block，进程控制块），存放着操作系统在对各个并发运行的进程进行管理时所需要的信息。是进程存在的唯一标志，当进程被创建时，该进程的PCB被创建，当进程结束时，该进程的PCB被回收。

##### 组成

- 进程描述信息
  -   进程标识符PID
  -   用户标识符UID
- 进程控制和管理信息
  - CPU、磁盘、网络流量使用情况统计
  - 进程当前状态：就绪态/阻塞态/运行态
- 资源分配清单
  - 正在使用那些文件
  - 正在使用那些内存区域
  - 正在使用那些I/O设备
- 处理机相关信息
  - 如PSW、PC等等寄存器的值（用于实现进程切换）

#### 程序段

程序的代码（指令序列）

#### 数据段

运行过程钟产生的各种数据（例如：程序中定义的变量）

### 特征

- 动态性
  进程是程序的一次执行过程，是动态地产生、变化、和消亡的；进程最基本的特征
- 并发性
  内存中有多个进程实体，各进程可并发执行
- 独立性
  进程是能独立运行、独立获取资源的基本单位
- 异步性
  各进程按各自独立的、不可预知的速度向前推进，操作系统要提供“进程同步机制”来解决异步问题
- 结构性
  每个进程都会配置一个PCB。结构上看，进程由程序段、数据段、PCB组成



### 状态

进程PCB中，会有一个变量state来表示进程的当前状态。

#### 创建态

**new**

进程正在被创建时，处于创建态，该阶段操作系统为进程分配资源，初始化PCB

#### 就绪态（基本状态）

**ready**

进程创建完成后，进入就绪态，此时进程具备运行条件，但由于CPU无空闲，所以暂时不能运行

#### 运行态（基本状态）

**running**

进程正在CPU上运行，则该进程处于运行态。CPU会执行该进程对应的程序（执行指令序列）

#### 阻塞态（基本状态）

**waiting/blocked**

在进程运行过程中，如果发生请求等待某个事件的发生（如等待某种系统资源的分配，或者等待其他进程的响应）。在该事件发生前，进程无法继续往下执行，此时操作系统会让这个进程下CPU，并让它进入阻塞态。

当CPU空闲时，又会选择另一个就绪态的进程上CPU运行。

#### 终止态

**terminated**

一个进程可以执行exit系统调用，请求操作系统终止该进程。此时进程进入终止态，操作系统会让该进程下CPU，并回收内存空间等资源，最后还要回收该进程的PCB。当终止进程的工作完成之后，这个进程就彻底消失了。

### 状态转换

<img :src="$withBase='/img/os-process-status-changing.png'" class="align-center" />

### 组织

为了对同一个状态下的各个进程进行统一的管理，操作系统会将各个进程的PCB组织起来。

#### 链接方式

<img :src="$withBase='/img/os-process-linked.png'" class="align-center" />

- 按照进程状态将PCB分为多个队列
- 操作系统持有指向各个队列的指针

#### 索引方式

<img :src="$withBase='/img/os-process-index.png'" class="align-center"/>

- 根据进程状态的不同，建立几张索引表
- 操作系统持有指向各个索引表的指针

### 进程控制

进程控制就是要实现进程状态的转换。

#### 实现方式

采用原语实现。因为原语具有原子性。原语使用两条特权指令来实现原子性，关中断指令和开中断指令。CPU执行关中断指令后，将不再例行检查是否收到外部中断信号，直到CPU执行开中断指令。

#### 使用的原语

- 创建原语
  <img :src="$withBase='/img/os-create-primitive.png'" class="align-center" />
- 撤销原语
  <img :src="$withBase='/img/os-recall-primitive.png'" class="align-center"/>
- 阻塞和唤醒原语
  <img :src="$withBase='/img/os-waiting-primitive.png'" class="align-center"/>
- 切换原语
  <img :src="$withBase='/img/os-change-primitive.png'" class="align-center"/>



