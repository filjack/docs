# 字符串与散列

> 字符串与散列有许多相似的功能，那么他们各自的优缺点是什么？该怎么选择呢？

## 散列

1. 最大的优势，只需要在数据库中创建一个键，就可以把许多字段和值存储进去，但是字符串需要为每一个字段创建一个键。数据库中键数量的增多带来的主要问题和资源有关：
   - 为了对数据库以及数据库键的使用情况进行统计，Redis会为每个数据库键存储一些额外信息，并因此带来一些额外的内存消耗。
   - 当散列包含的字段数量比较少时，Redis会使用特殊的内存优化结构去存储散列中的字段和值。与字符串相比，这种优化结构存储相同的数据所需要的内存要少得多。使用内存优化结构的散列越多，内存优化结构的效果也就越明显。
   - 更多的数据库键也需要占用更多的CPU。每当Redis需要对数据库中的键进行处理时，数据库包含的键越多，进行处理所需的CPU资源就会越多，处理所耗费的时间也会越长，例如：
     - 统计数据库和数据库键的使用情况
     - 对数据库执行持久化操作，或者根据持久化文件还原数据库
     - 通过匹配模式在数据库中查找某个键，或者执行类似的查找操作。
   - 散列键可以有效组织起相关联的多项数据，使得针对数据的批量操作变得更加方便

## 字符串

1. 字符串提供的命令更加丰富，比如SETRANGE、GETRANGE命令等
2. 过期时间的设置是针对某个键的，所以无法针对散列中某个字段进行设置过期时间，但是如果对散列设置过期时间，那么到期后整个散列将被删除。此时可以使用字符串，针对字符创进行设置



## 选择

- 如果程序需要为每个数据项单独设置过期时间，使用字符串
- 如果程序需要对数据项执行诸如SETRANGE、GETRANGE、APPEND等操作，优先考虑字符串，也可以使用散列，然后将对应操作交给客户端去实现。
- 如果程序需要存储的数据项比较多，并且你希望尽可能地减少存储数据所需要的内存，就应该优先考虑使用散列值
- 如果多个数据项在逻辑上属于同一个组或者同一个类，那么应该优先考虑使用散列