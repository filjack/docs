# 主动更新策略

## `Cache Aside` 

由缓存的调用者，在更新数据库时，同时更新缓存

### 操作缓存和数据库时需要注意的问题

1. 删除缓存还是更新缓存？
   - 更新缓存：每次更新数据库时都更新缓存，无效写操作较多
   - 删除缓存：更新数据库时让缓存失效，查询时再更新缓存✔
2. 如何保证缓存与数据库操作的同时成功或失败？
   - 单体系统：将缓存与数据库操作放在一个事务中
   - 分布式系统：利用TCC等分布式事务解决方案
3. 先操作缓存还是先操作数据库？
   - 先删除缓存，再操作数据库
   - 先操作数据库，再删除缓存（该方案在并发场景下，产生错误的概率较低）✔

## `Read/Write Through` 

缓存与数据库整合为一个服务，由服务来维护一致性。调用者调用该服务，无需关心缓存一致性问题。

## `Write Behind Caching` 

调用者只操作缓存，由其它线程异步的比较缓存数据与数据库数据，并将缓存中较新的数据持久化到数据库中去，保持最终一致性。