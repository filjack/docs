# 多级缓存

传统缓存，是由用户请求至Tomcat，再由Tomcat访问Redis缓存，如果缓存命中则直接返回，如果未命中则访问服务或者数据库。

由于Tomcat的性能并不如Redis，所以此时Tomcat成为系统的瓶颈。

多级缓存就是充分利用请求处理的每个环节，分别添加缓存，减轻Tomcat的压力，提升服务性能。

## JVM进程缓存

### 本地进程缓存

缓存由于存储在内存中，数据的读取速度非常快，能大量减少对数据库的访问，减少数据库的压力，一般分为：

- 分布式缓存：Redis
  - 优点：存储容量大、可靠性好、可以在集群间共享
  - 缺点：访问缓存有网络开销
  - 场景：缓存数据量大、可靠性要求较高、需要在集群间共享
- 进程本地缓存：HashMap、GuavaCache
  - 优点：读取本地内存、没有网络开销、速度更快
  - 缺点：存储容量有限、可靠性较低、无法共享
  - 场景：性能要求较高，缓存数据量较小

#### Caffeine

Caffeine提供了三种缓存驱逐策略：

- 基于容量，设置缓存的数量上限
- 基于时间：设置缓存的有效时间
- 基于引用：设置缓存为软引用或弱引用，利用GC来回收缓存数据。性能较差，不建议使用。

在默认情况下，当一个缓存元素过期的时候，Caffeine不会自动立即将其清理和驱逐。而是在一次读或写操作后，或者在空闲时间完成对失效数据的驱逐。



## Nginx

### OpenRestry